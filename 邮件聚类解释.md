## 邮件聚类与合并机制说明

### 示例邮件
- 邮件1（48h 内）：主题“Re: 项目A 会议纪要 v2”，正文含“项目A、纪要、行动项”
- 邮件2（同域名、48h 内）：主题“Fwd: 项目A 会议纪要（含 PPT）”，正文含“项目A、纪要、PPT”
- 邮件3（同域名、48h 内）：主题“项目A 会议议程”，正文含“项目A、会议、议程”
- 邮件4（无关）：主题“报销流程更新”，正文是费用/报销相关

### 处理流程
1. 预聚类（粗分组）
   - 基于“去前缀/票号”的主题指纹 + 发件人域 + 时间窗（默认 72h）
   - 邮件 1/2/3 被判定为“项目A+会议”主题 → 先进同一初始组；邮件 4 单独成组
2. 细化合并（TF‑IDF + 余弦相似度）
   - 对初始组内/组间计算文本相似度
   - 组 (1,2) 与 3 的相似度 ≈ 0.62 ≥ 阈值 0.55 → 合并为“项目A会议线程”
   - 任一邮件与邮件 4 的相似度 ≈ 0.1 < 阈值 → 不合并，保留为“报销”线程

### 结果输出
- 线程 A：包含邮件 1/2/3，LLM 对整个线程统一生成待办/小结（上下文更完整、去重更少）
- 线程 B：仅邮件 4，单独总结

### 要点与可调参数
- 合并含义：把内容相近的邮件归为同一“线程/分组”，统一输出与总结。
- 相似度阈值：`SIM_THRESHOLD`（默认 0.55）
  - 值高 → 更严格，减少误合并；值低 → 更宽松，但可能合并不相关邮件。
- 时间窗：`TIME_WINDOW_HOURS`（默认 72）
  - 限定“多久内的相似内容才视为同一话题”。

### 术语简述
- TF‑IDF：将文本转为向量，权重 = 词频 (TF) × 逆文档频率 (IDF)。常见词权重低、区分度高的词权重高。
- 余弦相似度：比较两向量夹角的余弦，越接近 1 越相似。

### 目的
- 避免同一话题因主题细微差异（如 Re/Fwd/票号变化）被拆成多条结果。
- 降低碎片、提升 LLM 总结质量与可读性。


